<!DOCTYPE html>
<html>
<head>
    <title>Driver Location for Police</title>
    <link rel="stylesheet" href="assets/css/styles.css">
    <script type="module">
        import { db, ref, onValue } from './firebase-config.js';

        function checkDriverLogin() {
            const driverID = localStorage.getItem('driverID');
            if (!driverID) {
                document.getElementById('loginPrompt').style.display = 'block';
                document.getElementById('locationContainer').style.display = 'none';
            } else {
                document.getElementById('loginPrompt').style.display = 'none';
                document.getElementById('locationContainer').style.display = 'block';
                fetchDriverLocation(driverID);
            }
        }

        function fetchDriverLocation(driverID) {
            const locationRef = ref(db, `drivers/${driverID}/location`);

            onValue(locationRef, (snapshot) => {
                if (snapshot.exists()) {
                    const { latitude, longitude } = snapshot.val();
                    document.getElementById('locationDetails').innerHTML = `
                        <p>üìç Driver Location: ${latitude}, ${longitude}</p>
                    `;
                    showMap(latitude, longitude);
                } else {
                    document.getElementById('locationDetails').innerHTML = "<p>üöî No location available yet.</p>";
                }
            }, (error) => {
                console.error("‚ùå Error fetching driver location:", error);
            });
        }

        function showMap(driverLat, driverLng) {
            const mapUrl = `https://www.google.com/maps/embed/v1/place?key=AIzaSyD1ZnITeqwr7gt6pMeGfnlR-EBL1kYPbXA&q=${driverLat},${driverLng}`;
            document.getElementById('map').innerHTML = `<iframe width="100%" height="500px" src="${mapUrl}" allowfullscreen></iframe>`;
        }

        document.addEventListener('DOMContentLoaded', checkDriverLogin);
    </script>
</head>
<body>
    <h2>üöî Police View - Driver Location</h2>

    <div id="loginPrompt" style="display: none;">
        <p>‚ùå No driver logged in. Please ensure a driver logs in first.</p>
    </div>

    <div id="locationContainer" style="display: none;">
        <div id="locationDetails"><p>Loading...</p></div>
        <div id="map" style="width: 100%; height: 500px; margin-top: 10px;"></div>
    </div>
</body>
</html>
